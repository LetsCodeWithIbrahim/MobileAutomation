package tests;

import java.io.IOException;

import org.testng.annotations.BeforeSuite;
import org.testng.annotations.Test;

import fixtures.DriverData;
import fixtures.TestOrchestration;
import pages.MyRoutePage;

public class CompleteDirectDeliveryShipmentTest extends BaseClass {

	@BeforeSuite
	public void setupSuite() throws InterruptedException {
		try {
			if (TestOrchestration.runCypressTests("npm run cypress:directdeliverytest")) {
				TestOrchestration.readResults();
			} else {
				throw new RuntimeException("Cypress tests failed. Cannot proceed with Appium tests.");
			}
		} catch (IOException e) {
			throw new RuntimeException("Failed to run Cypress tests or read results.", e);
		}
	}

	@Test
	public void completeDirectDeliveryShipment() throws IOException, InterruptedException {
		LoginTest loginTest = new LoginTest();
		loginTest.login();
		setupSuite();
		String expectedText = TestOrchestration.getForwardRefNumber();
		MyRoutePage myRoutePage = new MyRoutePage(driver);

		// Verify the route info
		myRoutePage.verifyMyRouteInfo(expectedText);

		// Click the Start Route button
		myRoutePage.clickStartRouteButton();

		Thread.sleep(10000);
		String odometerReading = "123456";
		myRoutePage.verifyScreenForOdometer(odometerReading);

		// Input initial odometer reading and submit
//        String odometerReading = "123456"; // Replace this with the actual reading if needed
//        myRoutePage.inputOdometerReading(odometerReading);
//        myRoutePage.clickSubmitInitialOdometerReading();
		Thread.sleep(5000);
		// myRoutePage.startedRoutesScreen();
		Thread.sleep(1500);
		myRoutePage.swipeUpToCompleteRoute();
		myRoutePage.clickOnCompleteShipment();
		myRoutePage.clickOnYesButton();
		Thread.sleep(1500);
		myRoutePage.clickNextButtonOnFirstScreen();
		myRoutePage.clickNextButtonOnSecondScreen();
		myRoutePage.addFirstFreightImage();
		myRoutePage.clickToTakePicture();
		myRoutePage.clickToSavePicture();
		myRoutePage.saveCroppedImage();
		Thread.sleep(2000);
		myRoutePage.clickOnTakePodImageCamIcon();
		myRoutePage.clickToTakePodImage();
		myRoutePage.clickToSavePodImage();
		myRoutePage.saveCroppedPodImage();
		myRoutePage.clickNextButtonOnThirdScreen();
		Thread.sleep(1500);
		DriverData driverData = DriverData.readFromJson();
		myRoutePage.firstName(driverData.getFirstName());
		myRoutePage.clickOnSubmitButton();
		Thread.sleep(30000);
	}

}
